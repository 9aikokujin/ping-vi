# Ping-Vi

Проект Ping-Vi предназначен для мониторинга доступности веб-сайта с целью предотвращения ошибок 404 и обеспечения его работоспособности.

## Зачем нужен
- Регулярные проверки URL.
- Раннее оповещение о недоступности и ошибках.
- История инцидентов и статистика аптайма(скриншот+уведомление).

## Возможности (черновик)
- HTTP/HTTPS проверки с таймаутами и порогами.
- Проверки динамических страниц через Playwright со скриншотами.
- Планировщик и очередь фоновых задач с интервалами (Celery + RabbitMQ).
- Уведомления через Telegram-бота с ссылками на сайт и статистику.
- Веб-панель со статистикой и историей проверок.
- Ролевая модель доступа, подписки и саб-пользователи.

## Архитектура
- API и админ-логика: FastAPI.
- Фоновая обработка: Celery + RabbitMQ.
- База данных: PostgreSQL + S3.
- Бот-интерфейс: aiogram.
- Frontend: React + Vite.

## Стек
- Backend: FastAPI, SQLAlchemy, Pydantic
- База данных: PostgreSQL
- Очереди и фоновые задачи: RabbitMQ, Celery
- Bot: aiogram
- Мониторинг страниц: Playwright
- Frontend: React + Vite

## Подписки (варианты)
- 30 дней
- 90 дней
- 1 год

## Тарифы (черновик)
- Free: 1 сайт; базовый пинг; статистика за 5 дней (график).
- Trial: 7 дней; 1 сайт; функционал как PinPlus; лимит проверок ~30 (уточняется).
- Pin: 2 сайта; легкий пинг через curl/wget; интервал 5 минут; статус ответа и график до 30 дней.
- PinPlus: 50 сайтов; легкий пинг через curl/wget или браузерный (Playwright); интервалы 1/5/15 минут; скриншоты (черновик: только при ошибках).
- Corporate: PinPlus + добавление пользователей; пакеты 5/10/100 пользователей (черновик); лимит сайтов зависит от числа пользователей.

  
## Потоки работы (черновик)
- **Онбординг.** Пользователь запускает бота и получает ссылку на WebApp; при первом входе создается User с ролью FreeUser.
- **Покупка подписки.** Оплата идет через платежный сервис; обновляются role_id и subscribe_end, создаются записи Transaction и History.
- **Саб-пользователи.** Корпоративный владелец добавляет tg_id/username; создается SubUser с подпиской до даты владельца; лимит сайтов 50*n-пользователей в подписке.
- **Добавление сайта.** Пользователь задает URL, тип пинга и интервал; проверяется лимит; создаются Site и первичная Statistic.
- **Мониторинг.** Задачи публикуются в RabbitMQ; проверки через request (код 200) или Playwright (статус + скриншот); статистика обновляется.
- **Оповещения и доступ.** При сбое бот отправляет время/статус/ссылки; просмотр статистики доступен владельцу или назначенному пользователю.

## Роли и права (черновик)
- Superuser - полный доступ и администрирование.
- CorpUser - владелец подписки, добавляет саб-пользователей и назначает ответственных за сайты.
- SubUser - участник корпоративной подписки с доступом к назначенным сайтам.
- PinUser - базовый платный доступ.
- PinPlusUser - расширенный платный доступ.
- FreeUser - бесплатный доступ с ограничениями.

## Хранение (черновик)
- Скриншоты храним за последние 2 суток; более старые сохраняются с почасовой частотой.
- Статистика и история проверок пишутся постоянно.
- Внутреннего баланса нет, только прямая покупка подписки.
